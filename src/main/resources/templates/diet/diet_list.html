<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>„ÉÄ„Ç§„Ç®„ÉÉ„Éà‰∏ÄË¶ß</title>
    <link rel="stylesheet" href="/css/dietList.css">
</head>

<body>
    <th:block th:insert="/common/header.html"></th:block>

    <div class="center">
        <div class="title">
            <h1>„ÉÄ„Ç§„Ç®„ÉÉ„ÉàÈÅ∏Êäû„ÄÄ‰∏ÄË¶ß</h1>
        </div>
        <div class="diet-search">
            <div class="search-favo">
                <img src="/images/star_on.png">
                <img src="/images/update.png">
            </div>
            <div class="search-category">
                <select>
                    <option>ÈÅãÂãï</option>
                    <option>È£ü‰∫ã</option>
                    <option>„Åù„ÅÆ‰ªñ</option>
                </select>
                <select>
                    <option>easy</option>
                    <option>normal</option>
                    <option>hard</option>
                </select>
            </div>

            <form class="form">
                <input type="text" placeholder="üîç">
            </form>

        </div>

        <div class="background">
            <table>
                <thead>
                    <tr>
                        <th>„ÅäÊ∞ó„Å´ÂÖ•„Çä</th>
                        <th>ÂÆüÊñΩ</th>
                        <th>È†ÖÁõÆ</th>
                        <th>ÊúüÈñì</th>
                        <th>„Ç≥„Éü„É•„Éã„ÉÜ„Ç£</th>
                        <th>„Ç´„ÉÜ„Ç¥„É™</th>
                        <th>Èõ£ÊòìÂ∫¶</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="dietList : ${dietLists}">
                        <td class="star-img">
                            <img th:if="${dietList.favorite}" src="/images/star_on.png" alt="„ÅäÊ∞ó„Å´ÂÖ•„ÇäÁîªÂÉèon">
                            <img th:unless="${dietList.favorite}" src="/images/star_off.png" alt="„ÅäÊ∞ó„Å´ÂÖ•„ÇäÁîªÂÉèoff">
                        </td>
                        <td>
                            <img th:if="${dietList.select}" src="/images/update.png">
                            <img th:unless="${dietList.select}" src="/images/add.png">
                        </td>
                        <td th:text="${dietList.dietName}"></td>
                        <td th:text="${dietList.period}"></td>
                        <td th:text="${dietList.communityName}"></td>
                        <td th:text="${dietList.categoryName}"></td>
                        <td th:text="${dietList.difficultName}"></td>
                    </tr>
                </tbody>
            </table>
        </div>

    </div>

    <th:block th:insert="/common/footer.html"></th:block>
    <script>
        // „Ç≥„Éº„Éâ„Çí„Åì„Åì„Å´Ë®òËø∞„Åô„Çã

        var imagePaths = ["http://localhost:8080/images/star_off.png", "http://localhost:8080/images/star_on.png"]; // Âàá„ÇäÊõø„Åà„ÇãÁîªÂÉè„ÅÆ„Éë„Çπ„ÇíÈÖçÂàó„ÅßÁî®ÊÑè
        var starImages = document.getElementsByClassName('star-img');

        Array.from(starImages).forEach(function (starImage) { //„ÇØ„É™„ÉÉ„ÇØ„Åï„Çå„Åü„Çâ
            //Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÁîªÂÉè„Å´„Çà„Å£„Å¶ÂàùÊúüÂåñ„ÇíÂ§â„Åà„Çã
            console.log('starImage',starImage);
            var currentImagePath = starImage.children[0].src;//ÁîªÂÉèË¶ÅÁ¥†„ÇíÂèñÂæó
            console.log('currentImagePath',currentImagePath);
            var currentIndex = imagePaths.indexOf(currentImagePath);
            console.log('currentIndex',currentIndex);
            starImage.addEventListener('click', function () {
                var row = starImage.closest('tr');

                // Ë°åÂÜÖ„ÅÆÂêÑ„Çª„É´ÔºàtdË¶ÅÁ¥†Ôºâ„Åã„Çâ„ÉÄ„Ç§„Ç®„ÉÉ„ÉàÊÉÖÂ†±„ÇíÂèñÂæó
                var dietName = row.querySelector('td:nth-child(3)').textContent;

                currentIndex === 0 ? addToFavorites(dietName) : removeFromFavorites(dietName);//ÂÆüË°å„ÇíÂàá„ÇäÊõø„Åà„Çã

                currentIndex = (currentIndex + 1) % imagePaths.length; // Ê¨°„ÅÆÁîªÂÉè„ÅÆ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ„ÇíË®àÁÆó
                starImage.getElementsByTagName('img')[0].src = imagePaths[currentIndex]; // ÁîªÂÉè„ÇíÂàá„ÇäÊõø„Åà„Çã

            });
        });


        function addToFavorites(dietName) {
            const url = '/api-diet-favorite'; // REST„Ç≥„É≥„Éà„É≠„Éº„É©„Éº„ÅÆ„Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàURL

            const requestData = {
                dietName: dietName
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => {
                    if (response.ok) {
                        console.log('„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅåËøΩÂä†„Åï„Çå„Åæ„Åó„Åü');
                    } else {
                        console.error('„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆËøΩÂä†„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                })
                .catch(error => {
                    console.error('„Ç®„É©„Éº:', error);
                });
        }

        function removeFromFavorites(dietName) {
            const url = '/api-diet-favorite'; // REST„Ç≥„É≥„Éà„É≠„Éº„É©„Éº„ÅÆ„Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàURL

            const requestData = {
                dietName: dietName
            };

            fetch(url, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(requestData)
            })
                .then(response => {
                    if (response.ok) {
                        console.log('„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅåÂâäÈô§„Åï„Çå„Åæ„Åó„Åü');
                    } else {
                        console.error('„ÅäÊ∞ó„Å´ÂÖ•„Çä„ÅÆÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                    }
                })
                .catch(error => {
                    console.error('„Ç®„É©„Éº:', error);
                });
        }

        window.addEventListener('DOMContentLoaded', function () {
            // „Ç≥„Éº„Éâ„Çí„Åì„Åì„Å´Ë®òËø∞„Åô„Çã
        });
    </script>
</body>

</html>